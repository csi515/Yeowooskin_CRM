# 테스트 시나리오 - 프랜차이즈 CRM

## 🎯 테스트 개요

프랜차이즈 구조의 역할 기반 접근 제어 및 데이터 분리를 검증하기 위한 테스트 시나리오입니다.

## 📋 테스트 케이스

### 1. 회원가입 및 역할 선택

#### HQ 계정 생성
1. **회원가입 페이지 접근**
   - URL: `/signup`
   - 역할 선택 단계 표시 확인

2. **역할 선택**
   - "본사 (HQ)" 선택
   - 세부 정보 단계로 진행

3. **지점 생성 정보 입력**
   - 지점명, 주소, 전화번호 입력
   - 이메일, 비밀번호 입력
   - "본사 계정 생성" 버튼 클릭

4. **성공 확인**
   - "본사 회원가입이 완료되었습니다." 메시지 표시
   - 로그인 페이지로 리다이렉트

#### Owner 계정 생성
1. **초대 링크 수신** (사전 준비)
   - HQ가 Owner 초대 이메일 발송

2. **회원가입 진행**
   - 역할: "점주 (Owner)" 선택
   - 지점 코드 입력 (HQ가 제공한 코드)
   - 개인 정보 입력

3. **성공 확인**
   - 프로필에 Owner 역할 및 branch_id 할당 확인

#### Staff 계정 생성
1. **초대 링크 수신** (사전 준비)
   - Owner가 Staff 초대 이메일 발송

2. **회원가입 진행**
   - 역할: "직원 (Staff)" 선택
   - 지점 코드 및 초대 코드 입력
   - 개인 정보 입력

3. **성공 확인**
   - 프로필에 Staff 역할 및 branch_id 할당 확인

### 2. 역할 기반 네비게이션

#### HQ 로그인 시
- **네비게이션 메뉴 확인**
  - 대시보드, 지점 관리, 분석 리포트, 예약, 제품, 고객, 직원, 재무, 설정
- **접근 가능 페이지 확인**
  - 모든 페이지 접근 가능

#### Owner 로그인 시
- **네비게이션 메뉴 확인**
  - 대시보드, 예약, 제품, 고객, 직원, 재무, 설정
- **접근 불가 메뉴 숨김 확인**
  - 지점 관리, 분석 리포트 메뉴 없음

#### Staff 로그인 시
- **네비게이션 메뉴 확인**
  - 대시보드, 예약, 제품, 고객, 설정
- **접근 불가 메뉴 숨김 확인**
  - 직원, 재무 메뉴 없음

### 3. 데이터 접근 제어

#### 지점별 데이터 분리
1. **다중 지점 생성** (HQ)
   - 지점 A, 지점 B 생성
   - 각 지점에 Owner 할당

2. **데이터 생성**
   - 지점 A Owner로 로그인
   - 고객, 예약, 제품 데이터 생성
   - 지점 B Owner로 로그인
   - 별도 고객, 예약, 제품 데이터 생성

3. **접근 권한 검증**
   - 지점 A Owner: 지점 A 데이터만 조회 가능
   - 지점 B Owner: 지점 B 데이터만 조회 가능
   - HQ: 모든 지점 데이터 조회 가능

#### 재무 데이터 접근
1. **Owner 재무 접근**
   - 본인 지점 재무만 조회 가능
   - 타 지점 데이터 접근 불가

2. **Staff 재무 접근 차단**
   - 재무 페이지 접근 시도
   - 403 권한 없음 페이지 표시

### 4. 초대 시스템

#### Owner가 Staff 초대
1. **초대 생성**
   - 직원 관리 → 초대 관리 탭
   - "직원 초대" 버튼 클릭
   - 이메일, 역할 선택
   - 초대 생성 성공

2. **초대 수락**
   - 초대받은 이메일로 회원가입
   - 지점 코드 + 초대 코드 입력
   - Staff 계정 생성 완료

3. **초대 관리**
   - 초대 목록에서 상태 확인
   - 사용됨/만료됨 상태 표시

### 5. 설정 페이지 역할별 표시

#### HQ 설정
- 모든 탭 표시: 가게 정보, 예약 설정, 재무 설정, 계정 설정, 시스템 설정

#### Owner 설정
- 제한된 탭 표시: 가게 정보, 예약 설정, 재무 설정, 계정 설정, 시스템 설정
- 일부 설정 옵션 비활성화

#### Staff 설정
- 제한된 탭 표시: 가게 정보, 계정 설정, 시스템 설정
- 재무/예약 설정 탭 숨김

### 6. 에러 처리 및 보안

#### 권한 없는 페이지 접근
1. **직접 URL 접근**
   - Staff 계정이 재무 페이지 URL 직접 접근
   - 403 페이지 표시

2. **API 직접 호출**
   - 권한 없는 API 엔드포인트 호출
   - 403 에러 응답 확인

#### 잘못된 초대 코드
1. **만료된 코드 사용**
   - 만료된 초대 코드로 회원가입 시도
   - "유효하지 않은 초대 코드" 에러 표시

2. **잘못된 지점 코드**
   - 존재하지 않는 지점 코드 입력
   - "유효하지 않은 지점 코드" 에러 표시

## 🔧 테스트 환경 설정

### 필수 데이터 준비
1. **지점 생성**: 최소 2개 지점 (HQ)
2. **사용자 계정**:
   - 1개 HQ 계정
   - 2개 Owner 계정 (각 지점당 1개)
   - 2개 Staff 계정 (각 지점당 1개)

### 테스트 계정 정보
```
HQ: hq@test.com / password123
Owner_A: owner_a@test.com / password123 (지점 A)
Owner_B: owner_b@test.com / password123 (지점 B)
Staff_A: staff_a@test.com / password123 (지점 A)
Staff_B: staff_b@test.com / password123 (지점 B)
```

## 📝 테스트 결과 기록

### 통과 케이스
- [ ] 회원가입 플로우 정상 동작
- [ ] 역할별 네비게이션 올바르게 표시
- [ ] 데이터 접근 제어 정상 작동
- [ ] 초대 시스템 정상 동작
- [ ] 설정 페이지 역할별 표시
- [ ] 권한 없는 접근 차단

### 실패 케이스
- [ ] 발견된 버그 및 이슈 기록

## 🚀 배포 전 체크리스트

- [ ] 모든 RLS 정책 적용 확인
- [ ] 환경 변수 올바르게 설정
- [ ] 마이그레이션 파일 실행 완료
- [ ] 테스트 시나리오 전부 통과
- [ ] 초기 HQ 계정 생성 확인
